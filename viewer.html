<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Visionneuse 3D avec Mesure de Distance</title>
  <style>
    body {
      margin: 0;
      background: #111;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    canvas {
      width: 90vw;
      height: 80vh;
    }

    .return-button {
      margin-top: 1.5rem;
      text-decoration: none;
      background-color: #0070f3;
      color: white;
      padding: 0.6rem 1.2rem;
      border-radius: 25px;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.3s ease-in-out;
    }

    .return-button:hover {
      background-color: #005bb5;
      transform: scale(1.05);
    }

    #distanceDisplay {
      position: absolute;
      top: 10%;
      font-size: 1.2rem;
      font-weight: bold;
      color: yellow;
      z-index: 2;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <div id="distanceDisplay">Distance: 0 m</div>
  <a href="index.html" class="return-button">← Retour au catalogue</a>

  <!-- Trois.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/loaders/GLTFLoader.js"></script>
  <script>
    let scene, camera, renderer, raycaster, mouse, model;
    let point1 = null, point2 = null;

    // Fonction pour calculer la distance entre deux points dans l'espace 3D
    function calculateDistance(p1, p2) {
      const dx = p2.x - p1.x;
      const dy = p2.y - p1.y;
      const dz = p2.z - p1.z;
      return Math.sqrt(dx * dx + dy * dy + dz * dz);
    }

    // Initialisation de la scène Three.js
    function init() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas') });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // Raycaster et souris
      raycaster = new THREE.Raycaster();
      mouse = new THREE.Vector2();

      // Lumières
      const light = new THREE.AmbientLight(0xffffff, 1);
      scene.add(light);

      // Charger le modèle
      const loader = new THREE.GLTFLoader();
      loader.load('models/testhd.glb', function(gltf) {
        model = gltf.scene;
        scene.add(model);
        camera.position.z = 5; // Positionner la caméra pour voir le modèle
      });

      // Gestion des clics
      window.addEventListener('click', onClick, false);

      // Animation de la scène
      animate();
    }

    // Fonction de gestion des clics pour détecter l'interaction
    function onClick(event) {
      // Calculer les coordonnées de la souris dans l'espace de la fenêtre
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

      // Mettre à jour le raycaster
      raycaster.updateMatrixWorld();
      raycaster.setFromCamera(mouse, camera);

      // Détecter les intersections avec le modèle
      const intersects = raycaster.intersectObject(model, true);

      if (intersects.length > 0) {
        const point = intersects[0].point;

        // Si c'est le premier point, on le stocke
        if (!point1) {
          point1 = point;
          document.getElementById('distanceDisplay').innerText = 'Distance: 0 m'; // Réinitialiser
        } 
        // Si c'est le deuxième point, on le stocke et on calcule la distance
        else if (!point2) {
          point2 = point;
          const distance = calculateDistance(point1, point2);
          document.getElementById('distanceDisplay').innerText = 'Distance: ' + distance.toFixed(2) + ' m';
        }
      }
    }

    // Fonction d'animation pour rendre la scène
    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }

    // Initialisation
    init();
  </script>
</body>
</html>
















